<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Weather layer</title>
  <style>
  html, body, #map-canvas {
    height: 100%;
    background-color: white;
  }

  #fluid {
    float: left;
    width: 100%;
    margin-right: -320px; /* The size of the fixed block. */
  }
  #inner-block {
    margin-right: 320px; /* The size of the fixed block. */
  }
  #fixed-width {
    float: left;
    width: 320px; /* The size of the fixed block. */
  }

  #Button {
      background: green;
      display:block;
      height:80px;
      width:232px;
      font-size:14px;
      text-indent:-9999px;
      padding-bottom: 20px;
  }
  #Button:hover{
  width: 232px;
  height: 80px;
  background-position: -232px 0;
  }
  #Button:active {
  width: 232px;
  height: 80px;
  background-position: -464px 0;
  }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=weather"></script>
  <script src="http://gmaps-utility-library.googlecode.com/svn/trunk/markermanager/release/src/markermanager.js"></script>
  <script type="text/javascript" src="./src/StyledMarker.js"></script>


  <script>
  function initialize() {
    xmlUrl = "http://www.tfl.gov.uk/tfl/syndication/feeds/cycle-hire/livecyclehireupdates.xml";
    var request = new XMLHttpRequest();
    request.open('GET', xmlUrl, true);
    request.onload = function() {
      loadData(request.responseXML);
    };
    request.send();
    
  }
  function loadData(data)
  {
  
     var mapOptions = {
      zoom: 12,
      center: new google.maps.LatLng(51.518175,-0.128721)
    };
    
    var map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
     var weatherLayer = new google.maps.weather.WeatherLayer({
      temperatureUnits: google.maps.weather.TemperatureUnit.CELCIUS
    });
    weatherLayer.setMap(map);
    var cloudLayer = new google.maps.weather.CloudLayer();
    cloudLayer.setMap(map);
    var stations = data.documentElement.getElementsByTagName("station");
    for(i=0;i<stations.length;i++)
    {
       var latLng = new google.maps.LatLng(stations[i].getElementsByTagName("lat")[0].firstChild.data,stations[i].getElementsByTagName("long")[0].firstChild.data);
        var nbBikes = stations[i].getElementsByTagName("nbBikes")[0].firstChild.data;
        var name = stations[i].getElementsByTagName("name")[0].firstChild.data;
          
         //createMarker(latLng,map);
         createCircle(latLng,nbBikes,name,map);
    }
  }
    function createMarker(latLng,map)
    {
            var marker = new google.maps.Marker({
            position: latLng,
            map: map});
  }
    function createCircle(latLng,nbBikes,name,map)
    {
      var styleIconClass;

      /*var stationOptions = {
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.35,
      map: map,
      center: latLng,
      radius: nbBikes*1
      };*/

      if(nbBikes>20)
        styleIconClass = new StyledIcon(StyledIconTypes.CLASS,{color:"#0033FF"});
      else if(nbBikes<5)
      {
        styleIconClass = new StyledIcon(StyledIconTypes.CLASS,{color:"#FF0000"});
      }
      else
      {
        styleIconClass = new StyledIcon(StyledIconTypes.CLASS,{color:"#458B00"});
      }

    var html = "<div class='infowindow'><b>" + name + "</b> <br/>" + "Number of Bikes: " + nbBikes +'<br/></div>';
    var infowindow = new google.maps.InfoWindow({content: html});
    var circle = new StyledMarker({styleIcon:new StyledIcon(StyledIconTypes.MARKER,{text:nbBikes},styleIconClass),position:latLng,map:map});
    google.maps.event.addListener(circle,"click",function()
    {
      infowindow.setPosition(latLng);
      infowindow.open(map);
    });
    }
  google.maps.event.addDomListener(window, 'load', initialize);
  </script>
</head>
<body>
  <div id="pediogyOverall" style="width: 100%; height: 100%;background:black;" >
    <div id="pediogyToolbar" style="float: left; display: inline-block; width: 25%; height: 100%; background: black;">
        <p id = "date" style = "text-align:center; color:white; float:left; width:100%; ">Thu Dec 04 2014</p>
        <p id = "temp" style = "text-align:center; color:white; float:left; width:100%; ">5 degrees celcius</p>
        <p id = "wind" style = "text-align:center; color:white; float:left; width:100%; ">4 knots</p>
        <p id = "weather" style = "text-align:center; color:white; float:left; width:100%; ">Cloudy</p>  
    </div>
    <div id="pediogyViewer" style="float: left;display: inline-block; width: 75%; height: 100%; background: white;">
      <div id="blab" style="width: 100%; height: 80%; background: white; text-align: center;">
          <div id="map-canvas"></div>
      </div>
      <div id="phpDebug" style="width: 100%; height: 20%; background: white;  margin-left: auto; margin-right: auto; float: left">
        <input id = "slider" type = "range" style = "position:relative; width:100%;"></input>
        <div id="buttonSpace" style="width: 100%; text-align: center; margin-bottom:20px;">
          <button type = "button" id = "play"  >Daily</button>
          <button type = "button" id = "hourly"  >Hourly</button>
          <button type = "button" id = "simulation" >Simulation</button>
          <input type="checkbox" id = "checkBox" name="option1" value="DisplayLines" ><br>


          <form action = "" id = "playspeed" style = "padding-top:10px;">
            <select id = "speed" style = "border-radius:10px; font-size:30px;">
              <option value= "1.0" selected>1.0x</option>
              <option value= "1.5">1.5x</option>
              <option value= "2.0">2.0x</option>
              <option value= "4.0">4.0x</option>
            </select>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div id="cdiv" style = "width:20%; position: absolute; top: 350px; left: 20px; z-index:-10; background-color:rgba(0,0,0,0.95); border-radius:5px;">
    <p id = "charttitle" style = "color:white;">Graph</p>
    <canvas id="chart" width="300" height="200" padding="10px"></canvas>
  </div>
  <p id = "footer" style = "text-align:center; color:white; ">Weather Simulation tools</p>

</body>
</html>